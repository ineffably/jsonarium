{
  "type": "class",
  "name": "RenderTargetSystem",
  "sourcePath": "rendering/renderers/shared/renderTarget/RenderTargetSystem.ts",
  "extends": null,
  "implements": [],
  "description": "A render surface is a texture, canvas, or render target / export type RenderSurface = ICanvas | BindableTexture | RenderTarget; /** stores a render target and its frame / interface RenderTargetAndFrame { /** the render target */ renderTarget: RenderTarget; /** the frame to use when using the render target */ frame: Rectangle } /** An adaptor interface for RenderTargetSystem to support WebGL and WebGPU. This is used internally by the renderer, and is not intended to be used directly. / export interface RenderTargetAdaptor<RENDER_TARGET extends GlRenderTarget | GpuRenderTarget> { init( /** the renderer */ renderer: Renderer, /** the render target system */ renderTargetSystem: RenderTargetSystem<RENDER_TARGET> ): void /** A function copies the contents of a render surface to a texture */ copyToTexture( /** the render surface to copy from  */ sourceRenderSurfaceTexture: RenderTarget, /** the texture to copy to */ destinationTexture: Texture, /** the origin of the copy */ originSrc: { x: number; y: number }, /** the size of the copy */ size: { width: number; height: number }, /** the destination origin (top left to paste from!) */ originDest?: { x: number; y: number }, ): Texture /** starts a render pass on the render target */ startRenderPass( /** the render target to start the render pass on */ renderTarget: RenderTarget, /* the clear mode to use. Can be true or a CLEAR number 'COLOR | DEPTH | STENCIL' 0b111* */ clear: CLEAR_OR_BOOL, /** the color to clear to */ clearColor?: RgbaArray, /** the viewport to use */ viewport?: Rectangle ): void /** clears the current render target to the specified color */ clear( /** the render target to clear */ renderTarget: RenderTarget, /** the clear mode to use. Can be true or a CLEAR number 'COLOR | DEPTH | STENCIL' 0b111 */ clear: CLEAR_OR_BOOL, /** the color to clear to   */ clearColor?: RgbaArray, /** the viewport to use */ viewport?: Rectangle ): void /** finishes the current render pass */ finishRenderPass(renderTarget: RenderTarget): void /** called after the render pass is finished */ postrender?(renderTarget: RenderTarget): void; /** called before the render main pass is started */ prerender?(renderTarget: RenderTarget): void; /** initializes a gpu render target. Both renderers use this function to initialize a gpu render target Its different type of object depending on the renderer. / initGpuRenderTarget( /** the render target to initialize */ renderTarget: RenderTarget ): RENDER_TARGET /** called when a render target is resized */ resizeGpuRenderTarget( /** the render target to resize */ renderTarget: RenderTarget ): void /** destroys the gpu render target */ destroyGpuRenderTarget( /** the render target to destroy */ gpuRenderTarget: RENDER_TARGET ): void } /** A system that manages render targets. A render target is essentially a place where the shaders can color in the pixels. The render target system is responsible for binding the render target to the renderer, and managing the viewport. Render targets can be pushed and popped. To make it easier, you can also bind textures and canvases too. This will automatically create a render target for you. The render target itself is a lot more powerful than just a texture or canvas, as it can have multiple textures attached to it. It will also give ou fine grain control over the stencil buffer / depth texture. ```js // create a render target const renderTarget = new RenderTarget({ colorTextures: [new TextureSource({ width: 100, height: 100 })], }); // bind the render target renderer.renderTarget.bind(renderTarget); // draw something! ```",
  "category": "rendering",
  "deprecated": false,
  "methods": [
    {
      "name": "finishRenderPass",
      "params": [],
      "returnType": null,
      "description": "When rendering of a scene begins, this is where the root render surface is stored */ public rootRenderTarget: RenderTarget; /** This is the root viewport for the render pass*/ public rootViewPort = new Rectangle(); /** A boolean that lets the dev know if the current render pass is rendering to the screen. Used by some plugins */ public renderingToScreen: boolean; /** the current active render target */ public renderTarget: RenderTarget; /** the current active render surface that the render target is created from */ public renderSurface: RenderSurface; /** the current viewport that the gpu is using */ public readonly viewport = new Rectangle(); /** a runner that lets systems know if the active render target has changed. Eg the Stencil System needs to know so it can manage the stencil buffer / public readonly onRenderTargetChange = new SystemRunner('onRenderTargetChange'); /** the projection matrix that is used by the shaders based on the active render target and the viewport */ public readonly projectionMatrix = new Matrix(); /** the default clear color for render targets */ public readonly defaultClearColor: RgbaArray = [0, 0, 0, 0]; /** a reference to the adaptor that interfaces with WebGL / WebGP */ public readonly adaptor: RenderTargetAdaptor<RENDER_TARGET>; /** a hash that stores the render target for a given render surface. When you pass in a texture source, a render target is created for it. This map stores and makes it easy to retrieve the render target / private readonly _renderSurfaceToRenderTargetHash: Map<RenderSurface, RenderTarget> = new Map(); /** A hash that stores a gpu render target for a given render target. */ private _gpuRenderTargetHash: Record<number, RENDER_TARGET> = Object.create(null); /** A stack that stores the render target and frame that is currently being rendered to. When push is called, the current render target is stored in this stack. When pop is called, the previous render target is restored. / private readonly _renderTargetStack: RenderTargetAndFrame[] = []; /** A reference to the renderer */ private readonly _renderer: Renderer; constructor(renderer: Renderer) { this._renderer = renderer; renderer.renderableGC.addManagedHash(this, '_gpuRenderTargetHash'); } /** called when dev wants to finish a render pass"
    },
    {
      "name": "finishRenderPass",
      "params": [
        {
          "name": "this.renderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "renderStart",
      "params": [
        {
          "name": "{\n        target",
          "type": null
        },
        {
          "name": "clear",
          "type": null
        },
        {
          "name": "clearColor",
          "type": null
        },
        {
          "name": "target",
          "type": "RenderSurface;\n        clear: CLEAR_OR_BOOL;\n        clearColor: RgbaArray;\n        frame?: Rectangle\n    }",
          "optional": false,
          "default": null
        }
      ],
      "returnType": "void",
      "description": "called when the renderer starts to render a scene."
    },
    {
      "name": "push",
      "params": [
        {
          "name": "target",
          "type": null
        },
        {
          "name": "clear",
          "type": null
        },
        {
          "name": "clearColor",
          "type": null
        },
        {
          "name": "frame",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "copyFrom",
      "params": [
        {
          "name": "this.viewport",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "isRenderingToScreen",
      "params": [
        {
          "name": "this.rootRenderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "postrender",
      "params": [],
      "returnType": null,
      "description": null
    },
    {
      "name": "bind",
      "params": [
        {
          "name": "renderSurface",
          "type": "RenderSurface",
          "optional": false,
          "default": null
        },
        {
          "name": "clear",
          "type": "CLEAR_OR_BOOL",
          "optional": true,
          "default": "true"
        },
        {
          "name": "clearColor",
          "type": "RgbaArray",
          "optional": true,
          "default": null
        },
        {
          "name": "frame",
          "type": "Rectangle",
          "optional": true,
          "default": null
        }
      ],
      "returnType": "RenderTarget",
      "description": "Binding a render surface! This is the main function of the render target system. It will take the RenderSurface (which can be a texture, canvas, or render target) and bind it to the renderer. Once bound all draw calls will be rendered to the render surface. If a frame is not provide and the render surface is a texture, the frame of the texture will be used."
    },
    {
      "name": "getRenderTarget",
      "params": [
        {
          "name": "renderSurface",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "getGpuRenderTarget",
      "params": [
        {
          "name": "renderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "renderTarget.pixelWidth !== gpuRenderTarget.width\n            || renderTarget.pixelHeight !== gpuRenderTarget.height",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "resizeGpuRenderTarget",
      "params": [
        {
          "name": "renderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "!frame && renderSurface instanceof Texture",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "frame",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "calculateProjection",
      "params": [
        {
          "name": "this.projectionMatrix",
          "type": null
        },
        {
          "name": "0",
          "type": null
        },
        {
          "name": "0",
          "type": null
        },
        {
          "name": "viewport.width / source.resolution",
          "type": null
        },
        {
          "name": "viewport.height / source.resolution",
          "type": null
        },
        {
          "name": "!renderTarget.isRoot",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "startRenderPass",
      "params": [
        {
          "name": "renderTarget",
          "type": null
        },
        {
          "name": "clear",
          "type": null
        },
        {
          "name": "clearColor",
          "type": null
        },
        {
          "name": "viewport",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "didChange",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "emit",
      "params": [
        {
          "name": "renderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "clear",
      "params": [
        {
          "name": "target",
          "type": "RenderSurface",
          "optional": true,
          "default": null
        },
        {
          "name": "clear",
          "type": "CLEAR_OR_BOOL",
          "optional": true,
          "default": "CLEAR.ALL"
        },
        {
          "name": "clearColor",
          "type": "RgbaArray",
          "optional": true,
          "default": null
        },
        {
          "name": "",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "!clear",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "target",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "getRenderTarget",
      "params": [
        {
          "name": "target",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "clear",
      "params": [
        {
          "name": "(target as RenderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "contextChange",
      "params": [],
      "returnType": "void",
      "description": null
    },
    {
      "name": "create",
      "params": [
        {
          "name": "null",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "push",
      "params": [
        {
          "name": "renderSurface",
          "type": "RenderSurface",
          "optional": false,
          "default": null
        },
        {
          "name": "clear",
          "type": "CLEAR | boolean",
          "optional": true,
          "default": "CLEAR.ALL"
        },
        {
          "name": "clearColor",
          "type": "RgbaArray",
          "optional": true,
          "default": null
        },
        {
          "name": "frame",
          "type": "Rectangle",
          "optional": true,
          "default": null
        }
      ],
      "returnType": null,
      "description": "Push a render surface to the renderer. This will bind the render surface to the renderer,"
    },
    {
      "name": "bind",
      "params": [
        {
          "name": "renderSurface",
          "type": null
        },
        {
          "name": "clear",
          "type": null
        },
        {
          "name": "clearColor",
          "type": null
        },
        {
          "name": "frame",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "push",
      "params": [
        {
          "name": "{\n            renderTarget",
          "type": null
        },
        {
          "name": "frame",
          "type": null
        },
        {
          "name": "}",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "pop",
      "params": [],
      "returnType": null,
      "description": "Pops the current render target from the renderer and restores the previous render target."
    },
    {
      "name": "pop",
      "params": [],
      "returnType": null,
      "description": null
    },
    {
      "name": "bind",
      "params": [
        {
          "name": "currentRenderTargetData.renderTarget",
          "type": null
        },
        {
          "name": "false",
          "type": null
        },
        {
          "name": "null",
          "type": null
        },
        {
          "name": "currentRenderTargetData.frame",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "getRenderTarget",
      "params": [
        {
          "name": "renderSurface",
          "type": "RenderSurface",
          "optional": false,
          "default": null
        }
      ],
      "returnType": "RenderTarget",
      "description": "Gets the render target from the provide render surface. Eg if its a texture, it will return the render target for the texture. If its a render target, it will return the same render target."
    },
    {
      "name": "if",
      "params": [
        {
          "name": "((renderSurface as Texture",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "get",
      "params": [
        {
          "name": "renderSurface",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "copyToTexture",
      "params": [
        {
          "name": "sourceRenderSurfaceTexture",
          "type": "RenderTarget",
          "optional": false,
          "default": null
        },
        {
          "name": "destinationTexture",
          "type": "Texture",
          "optional": false,
          "default": null
        },
        {
          "name": "originSrc",
          "type": "{ x: number; y: number }",
          "optional": false,
          "default": null
        },
        {
          "name": "size",
          "type": "{ width: number; height: number }",
          "optional": false,
          "default": null
        },
        {
          "name": "originDest",
          "type": "{ x: number; y: number; }",
          "optional": false,
          "default": null
        },
        {
          "name": "",
          "type": null
        }
      ],
      "returnType": null,
      "description": "Copies a render surface to another texture. NOTE: for sourceRenderSurfaceTexture, The render target must be something that is written too by the renderer The following is not valid: const canvas = document.createElement('canvas') canvas.width = 200; canvas.height = 200; const ctx = canvas2.getContext('2d')! ctx.fillStyle = 'red' ctx.fillRect(0, 0, 200, 200); const texture = RenderTexture.create({ width: 200, height: 200, }) const renderTarget = renderer.renderTarget.getRenderTarget(canvas2); renderer.renderTarget.copyToTexture(renderTarget,texture, {x:0,y:0},{width:200,height:200},{x:0,y:0}); The best way to copy a canvas is to create a texture from it. Then render with that. Parsing in a RenderTarget canvas context (with a 2d context)"
    },
    {
      "name": "if",
      "params": [
        {
          "name": "originSrc.x < 0",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "originSrc.y < 0",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "min",
      "params": [
        {
          "name": "size.width",
          "type": null
        },
        {
          "name": "pixelWidth - originSrc.x",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "min",
      "params": [
        {
          "name": "size.height",
          "type": null
        },
        {
          "name": "pixelHeight - originSrc.y",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "copyToTexture",
      "params": [
        {
          "name": "sourceRenderSurfaceTexture",
          "type": null
        },
        {
          "name": "destinationTexture",
          "type": null
        },
        {
          "name": "originSrc",
          "type": null
        },
        {
          "name": "size",
          "type": null
        },
        {
          "name": "originDest",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "ensureDepthStencil",
      "params": [],
      "returnType": null,
      "description": "ensures that we have a depth stencil buffer available to render to This is used by the mask system to make sure we have a stencil buffer."
    },
    {
      "name": "if",
      "params": [
        {
          "name": "!this.renderTarget.stencil",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "startRenderPass",
      "params": [
        {
          "name": "this.renderTarget",
          "type": null
        },
        {
          "name": "false",
          "type": null
        },
        {
          "name": "null",
          "type": null
        },
        {
          "name": "this.viewport",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "destroy",
      "params": [],
      "returnType": null,
      "description": "nukes the render target system"
    },
    {
      "name": "forEach",
      "params": [
        {
          "name": "(renderTarget",
          "type": null
        },
        {
          "name": "key",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "renderTarget !== key",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "destroy",
      "params": [],
      "returnType": null,
      "description": null
    },
    {
      "name": "clear",
      "params": [],
      "returnType": null,
      "description": null
    },
    {
      "name": "create",
      "params": [
        {
          "name": "null",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "CanvasSource.test(renderSurface",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "getCanvasTexture",
      "params": [
        {
          "name": "renderSurface as ICanvas",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "renderSurface instanceof RenderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "renderSurface instanceof TextureSource",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "renderSurface.source instanceof CanvasSource",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "once",
      "params": [
        {
          "name": "'destroy'",
          "type": null
        },
        {
          "name": "(",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "destroy",
      "params": [],
      "returnType": null,
      "description": null
    },
    {
      "name": "delete",
      "params": [
        {
          "name": "renderSurface",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "if",
      "params": [
        {
          "name": "gpuRenderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "destroyGpuRenderTarget",
      "params": [
        {
          "name": "gpuRenderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "set",
      "params": [
        {
          "name": "renderSurface",
          "type": null
        },
        {
          "name": "renderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "getGpuRenderTarget",
      "params": [
        {
          "name": "renderTarget",
          "type": "RenderTarget",
          "optional": false,
          "default": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "initGpuRenderTarget",
      "params": [
        {
          "name": "renderTarget",
          "type": null
        }
      ],
      "returnType": null,
      "description": null
    },
    {
      "name": "resetState",
      "params": [],
      "returnType": "void",
      "description": null
    }
  ],
  "properties": []
}